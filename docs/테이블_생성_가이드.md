# textbook_requests í…Œì´ë¸” ìƒì„± ê°€ì´ë“œ

## ğŸš¨ ì—ëŸ¬: "ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"

ì´ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ Supabaseì— `textbook_requests` í…Œì´ë¸”ì´ ì—†ê±°ë‚˜ RLS ì •ì±…ì´ ì œëŒ€ë¡œ ì„¤ì •ë˜ì§€ ì•Šì€ ê²ƒì…ë‹ˆë‹¤.

---

## ğŸ“ í…Œì´ë¸” ìƒì„± ë°©ë²•

### 1. Supabase Dashboard ì ‘ì†
1. https://supabase.com ë¡œê·¸ì¸
2. í”„ë¡œì íŠ¸ ì„ íƒ (eng_lib)
3. ì¢Œì¸¡ ë©”ë‰´ **"SQL Editor"** í´ë¦­

### 2. SQL ì‹¤í–‰
ì•„ë˜ SQLì„ ë³µì‚¬í•´ì„œ ì‹¤í–‰í•˜ì„¸ìš”:

```sql
-- textbook_requests í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS textbook_requests (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  textbook_name VARCHAR(255) NOT NULL,
  request_count INTEGER DEFAULT 1,
  user_ip VARCHAR(50),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX IF NOT EXISTS idx_textbook_requests_name ON textbook_requests(textbook_name);
CREATE INDEX IF NOT EXISTS idx_textbook_requests_count ON textbook_requests(request_count DESC);
CREATE INDEX IF NOT EXISTS idx_textbook_requests_created_at ON textbook_requests(created_at DESC);

-- RLS í™œì„±í™”
ALTER TABLE textbook_requests ENABLE ROW LEVEL SECURITY;

-- RLS ì •ì±…: ëª¨ë“  ì‚¬ìš©ìê°€ ì½ê¸° ê°€ëŠ¥
CREATE POLICY "Public read access for textbook requests"
  ON textbook_requests
  FOR SELECT
  USING (true);

-- RLS ì •ì±…: ëª¨ë“  ì‚¬ìš©ìê°€ ìš”ì²­ ìƒì„± ê°€ëŠ¥
CREATE POLICY "Public insert access for textbook requests"
  ON textbook_requests
  FOR INSERT
  WITH CHECK (true);

-- RLS ì •ì±…: ì„œë¹„ìŠ¤ ì—­í• ë§Œ ì—…ë°ì´íŠ¸ ê°€ëŠ¥
CREATE POLICY "Service role update access for textbook requests"
  ON textbook_requests
  FOR UPDATE
  USING (true)
  WITH CHECK (true);

-- updated_at ìë™ ê°±ì‹  íŠ¸ë¦¬ê±°
CREATE OR REPLACE FUNCTION update_textbook_requests_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_textbook_requests_updated_at
  BEFORE UPDATE ON textbook_requests
  FOR EACH ROW
  EXECUTE FUNCTION update_textbook_requests_updated_at();
```

### 3. ì‹¤í–‰ í™•ì¸
- âœ… "Success. No rows returned" ë©”ì‹œì§€ í™•ì¸
- âŒ ì—ëŸ¬ ë°œìƒ ì‹œ: ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸ í›„ ìˆ˜ì •

---

## ğŸ” í…Œì´ë¸” í™•ì¸ ë°©ë²•

### 1. Table Editorì—ì„œ í™•ì¸
1. ì¢Œì¸¡ ë©”ë‰´ **"Table Editor"** í´ë¦­
2. `textbook_requests` í…Œì´ë¸”ì´ ë³´ì´ëŠ”ì§€ í™•ì¸

### 2. SQLë¡œ í™•ì¸
```sql
SELECT * FROM textbook_requests LIMIT 5;
```

### 3. êµ¬ì¡° í™•ì¸
```sql
SELECT 
  column_name, 
  data_type, 
  is_nullable
FROM information_schema.columns
WHERE table_name = 'textbook_requests'
ORDER BY ordinal_position;
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚½ì… (ì„ íƒì‚¬í•­)

```sql
-- í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚½ì…
INSERT INTO textbook_requests (textbook_name, request_count, user_ip)
VALUES 
  ('ìˆ˜ëŠ¥íŠ¹ê°• ì˜ì–´', 5, '192.168.1.xxx'),
  ('ëŠ¥ë¥  ì˜ì–´ 1-1', 3, '192.168.2.xxx'),
  ('ì²œì¬ ì˜ì–´ 2-1', 2, '192.168.3.xxx');

-- í™•ì¸
SELECT * FROM textbook_requests ORDER BY request_count DESC;
```

---

## âš ï¸ ë¬¸ì œ í•´ê²°

### ì—ëŸ¬ 1: "relation textbook_requests does not exist"
**ì›ì¸**: í…Œì´ë¸”ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ  
**í•´ê²°**: ìœ„ SQL ì‹¤í–‰

### ì—ëŸ¬ 2: "new row violates row-level security policy"
**ì›ì¸**: RLS ì •ì±… ë¬¸ì œ  
**í•´ê²°**: RLS ì •ì±… ì¬ìƒì„± (ìœ„ SQLì˜ RLS ë¶€ë¶„ ì‹¤í–‰)

### ì—ëŸ¬ 3: "permission denied for table textbook_requests"
**ì›ì¸**: ê¶Œí•œ ë¬¸ì œ  
**í•´ê²°**: 
```sql
GRANT ALL ON textbook_requests TO anon;
GRANT ALL ON textbook_requests TO authenticated;
```

---

## âœ… ì™„ë£Œ í™•ì¸

í…Œì´ë¸” ìƒì„± í›„ ë‹¤ì‹œ ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸:

1. `npm run dev` ì‹¤í–‰
2. "í…ŒìŠ¤íŠ¸êµì¬" ê²€ìƒ‰
3. "ì´ êµì¬ ìš”ì²­í•˜ê¸°" í´ë¦­
4. ìš”ì²­ ì œì¶œ

**ì„±ê³µ ì‹œ**: âœ… "ìš”ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!" ë©”ì‹œì§€  
**ì‹¤íŒ¨ ì‹œ**: ë¸Œë¼ìš°ì € ì½˜ì†”(F12) â†’ Network íƒ­ â†’ `/api/requests` í´ë¦­ â†’ Response í™•ì¸

---

## ğŸ“ ì¶”ê°€ ì§€ì›

ë¬¸ì œê°€ ê³„ì†ë˜ë©´:
1. ë¸Œë¼ìš°ì € ì½˜ì†” ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
2. Network íƒ­ì—ì„œ `/api/requests` ì‘ë‹µ í™•ì¸
3. Supabase Dashboard â†’ Logs â†’ API íƒ­ í™•ì¸

