# 영어 자료실 프로젝트 - 개발 계획 (ver 3.1+)

**작성일**: 2025-11-11  
**현재 버전**: ver 3.0 (배포 완료)  
**배포 URL**: https://eng-lib.vercel.app  
**문서 버전**: 1.0

---

## 📊 현재 상황 요약

### ✅ 완료된 Phase (ver 3.0)
- **Phase 1**: 기본 인프라 구축 (100%)
  - Next.js + Supabase + Dropbox 연동
  - Vercel 배포 완료
- **Phase 2**: 메인 페이지 기본 기능 (80%)
  - 3단 레이아웃
  - 파일 트리 + PDF 뷰어
  - 동기화 시스템
- **Phase 3**: 관리자 페이지 기초 (30%)
  - 레이아웃 구조
  - 동기화 관리 페이지

---

## 🎯 Phase 4: 핵심 기능 완성 (ver 3.1 ~ 3.3)

목표 기간: **2주** (2025-11-12 ~ 2025-11-25)  
목표: 메인 페이지 사용자 기능 100% 완성

---

### 🔥 Task 4.1: 클릭 추적 시스템 완성 ✅ **완료**

**목표**: 파일 클릭 로그 수집 및 실시간 통계 생성  
**우선순위**: ⭐⭐⭐⭐⭐ (최고)  
**예상 소요**: 2-3일  
**담당자**: [이름]  
**시작일**: 2025-11-11  
**완료일**: 2025-11-11

#### 📋 세부 작업

- [x] **4.1.1** 클릭 로그 저장 API 구현
  - 파일: `src/app/api/track/click/route.ts`
  - 기능:
    - POST `/api/track/click` 엔드포인트
    - 파일 ID 수신
    - 사용자 IP 수집 (익명화)
    - `file_clicks` 테이블에 INSERT
    - `files.click_count` 자동 증가 (트리거 활용)
  - 완료 조건:
    - [x] API 구현 완료
    - [x] 에러 핸들링 (파일 없음, DB 오류)
    - [x] GET 엔드포인트 추가 (테스트/디버깅용)

- [x] **4.1.2** 교재별 클릭수 집계 API
  - 파일: `src/app/api/track/textbook-stats/route.ts`
  - 기능:
    - GET `/api/track/textbook-stats` 엔드포인트
    - 교재별 총 클릭수 계산
    - 정렬 옵션 (이름순/클릭수순)
  - 완료 조건:
    - [x] API 구현 완료
    - [x] 정렬/순서 파라미터 지원

- [x] **4.1.3** 프론트엔드 클릭 이벤트 통합
  - 파일: `src/components/LeftSidebar.tsx`
  - 기능:
    - 파일 클릭 시 `/api/track/click` 호출
    - 비동기 처리 (사용자 경험 방해 X)
    - 에러 시 로깅만 (UI 영향 없음)
  - 완료 조건:
    - [x] `handleFileClick` 함수 추가
    - [x] 클릭 이벤트 연결
    - [x] 에러 핸들링 추가

- [x] **4.1.4** 최근 조회 자료 실시간 업데이트
  - 파일: `src/components/RightSidebar.tsx`
  - 기능:
    - `file_clicks` 테이블 Realtime 구독
    - 최근 10개 파일 표시 (시간순)
    - 자동 갱신
    - 중복 파일 제거 (TOP 5만 표시)
    - 상대 시간 표시 ("방금 전", "5분 전" 등)
  - 완료 조건:
    - [x] Realtime 구독 설정
    - [x] UI 업데이트 로직
    - [x] 로딩 상태 표시
    - [x] 시간 포맷팅 함수

#### ✅ 완료 기준
- [x] 파일 클릭 시 DB에 로그 저장
- [x] 교재별 클릭수 정확히 집계
- [x] 우측 패널 "최근 조회" 실시간 반영
- [ ] Vercel 배포 후 정상 작동 확인 ⏳ (다음 단계)

#### 📝 테스트 시나리오
1. 메인 페이지에서 PDF 파일 3개 클릭
2. 우측 패널 "최근 조회"에 즉시 표시 확인
3. 좌측 패널 교재 클릭수 증가 확인
4. 다른 브라우저에서 동일 파일 클릭 → 양쪽 모두 업데이트 확인

---

### 🎯 Task 4.2: 교재 요청 시스템 구현 ✅ **완료**

**목표**: 사용자가 없는 교재를 요청할 수 있는 기능  
**우선순위**: ⭐⭐⭐⭐ (높음)  
**예상 소요**: 1-2일  
**담당자**: [이름]  
**시작일**: 2025-11-11  
**완료일**: 2025-11-11

#### 📋 세부 작업

- [x] **4.2.1** 교재 요청 API 구현
  - 파일: `src/app/api/requests/route.ts`
  - 기능:
    - POST `/api/requests` - 요청 생성
    - GET `/api/requests` - 요청 목록 조회 (인기순)
    - 중복 요청 체크 (교재명 기준)
    - 중복 시 `request_count` 증가
    - IP 기반 중복 방지 (동일 IP는 24시간 1회)
  - 완료 조건:
    - [x] POST API 구현
    - [x] GET API 구현
    - [x] 중복 방지 로직 (24시간 1회)

- [x] **4.2.2** 요청 다이얼로그 UI
  - 파일: `src/components/RequestTextbookDialog.tsx` (신규)
  - 기능:
    - shadcn/ui Dialog 사용
    - 입력 폼 (교재명 필수)
    - 유효성 검사 (2자 이상)
    - 성공 시 체크마크 애니메이션
  - 완료 조건:
    - [x] Dialog 컴포넌트 생성
    - [x] 폼 검증 완료
    - [x] 성공/에러 UI

- [x] **4.2.3** 좌측 패널에 요청 버튼 추가
  - 파일: `src/components/LeftSidebar.tsx`
  - 기능:
    - 검색 결과 없을 때 "교재 요청하기" 버튼 표시
    - 버튼 클릭 시 다이얼로그 열기
    - 검색어 자동 입력
  - 완료 조건:
    - [x] 버튼 추가
    - [x] 다이얼로그 연동
    - [x] 검색어 자동 입력

- [x] **4.2.4** 우측 패널 요청 순위 실시간 업데이트
  - 파일: `src/components/RightSidebar.tsx`
  - 기능:
    - `textbook_requests` 테이블 Realtime 구독
    - 요청수 많은 순 TOP 5 표시
    - 순위 번호 및 요청수 뱃지 표시
  - 완료 조건:
    - [x] Realtime 구독 설정
    - [x] TOP 5 표시
    - [x] 로딩 상태 UI

#### ✅ 완료 기준
- [x] 검색 결과 없을 때 요청 버튼 표시
- [x] 요청 폼 제출 성공
- [x] DB에 요청 저장 확인
- [x] 우측 패널 순위 실시간 업데이트
- [x] 중복 요청 시 카운트만 증가
- [ ] Vercel 배포 후 정상 작동 확인 ⏳ (다음 단계)

#### 📝 테스트 시나리오
1. "존재하지 않는 교재" 검색 → "교재 요청하기" 버튼 표시
2. 버튼 클릭 → 다이얼로그 열림 (검색어 자동 입력)
3. 교재명 입력 후 제출
4. 토스트 알림 "요청이 접수되었습니다"
5. 우측 패널 "교재 요청 순위"에 표시 확인
6. 동일 교재 재요청 → 카운트만 증가 확인

---

### ✅ Task 4.3: 공지사항 시스템 구현 **완료**

**목표**: 관리자가 공지사항을 작성/관리하고 메인 페이지에 표시  
**우선순위**: ⭐⭐⭐⭐ (높음)  
**예상 소요**: 2-3일  
**담당자**: AI Assistant  
**시작일**: 2025-11-11  
**완료일**: 2025-11-11  
**상태**: ✅ 완료

#### 📋 세부 작업

- [x] **4.3.1** 공지사항 CRUD API 구현
  - 파일: `src/app/api/notices/route.ts` ✅
  - 기능:
    - GET `/api/notices` - 활성 공지 목록 ✅
    - POST `/api/notices` - 공지 생성 (관리자 전용) ✅
    - PUT `/api/notices` - 공지 수정 ✅
    - DELETE `/api/notices` - 공지 삭제 ✅
  - 완료 조건:
    - [x] CRUD API 모두 구현
    - [x] 관리자 권한 체크 (TODO 주석 추가, Phase 6에서 구현 예정)
    - [x] 에러 핸들링

- [x] **4.3.2** 관리자 공지사항 관리 페이지
  - 파일: `src/app/admin/notices/page.tsx` ✅
  - 기능:
    - 공지사항 목록 테이블 ✅
    - "새 공지 작성" 버튼 ✅
    - 수정/삭제 버튼 (각 행) ✅
    - 활성화/비활성화 토글 ✅
    - 작성일/수정일 표시 ✅
  - 완료 조건:
    - [x] 테이블 UI 완성
    - [x] CRUD 기능 모두 작동
    - [x] 토글 즉시 반영

- [x] **4.3.3** 공지 작성/수정 폼
  - 파일: `src/components/admin/NoticeForm.tsx` ✅
  - 기능:
    - Dialog 폼 ✅
    - 제목 (필수, 최소 2자) ✅
    - 내용 (필수, 최소 5자) ✅
    - 활성화 체크박스 ✅
  - 완료 조건:
    - [x] 폼 컴포넌트 생성
    - [x] 유효성 검사
    - [x] 제출 성공 시 목록 새로고침

- [x] **4.3.4** 메인 페이지 공지사항 표시
  - 파일: `src/components/RightSidebar.tsx` ✅
  - 기능:
    - 활성 공지 최신 3개 표시 ✅
    - Realtime 업데이트 (Supabase Realtime) ✅
    - 상대 시간 표시 ✅
  - 완료 조건:
    - [x] 공지 목록 표시
    - [x] Realtime 구독
    - [x] 스타일링 완료

#### ✅ 완료 기준
- [x] 관리자 페이지에서 공지 작성 가능
- [x] 작성된 공지가 메인 페이지 우측에 즉시 표시
- [x] 수정/삭제 시 즉시 반영
- [x] 비활성화된 공지는 메인 페이지에 미표시

#### 📦 생성된 파일
- `src/app/api/notices/route.ts` - 공지사항 CRUD API
- `src/app/admin/notices/page.tsx` - 관리자 공지사항 관리 페이지
- `src/components/admin/NoticeForm.tsx` - 공지 작성/수정 폼
- `src/components/ui/textarea.tsx` - Textarea 컴포넌트
- `src/components/ui/checkbox.tsx` - Checkbox 컴포넌트
- `supabase/migrations/003_create_notices.sql` - notices 테이블 생성 SQL
- `docs/공지사항_테이블_생성_가이드.md` - 테이블 생성 가이드

#### 📝 테스트 시나리오
1. `/admin/notices` 접속
2. "새 공지 작성" 클릭
3. 제목/내용 입력 후 저장
4. 메인 페이지 새로고침 없이 우측 패널에 표시 확인
5. 공지 수정 → 메인 페이지 즉시 반영 확인
6. 비활성화 토글 → 메인 페이지에서 사라짐 확인

---

## 📊 Phase 5: 관리자 대시보드 완성 (ver 3.4 ~ 3.6)

목표 기간: **3주** (2025-11-26 ~ 2025-12-16)  
목표: 관리자가 통계 및 요청을 효과적으로 관리

---

### ✅ Task 5.1: 실제 통계 API 구현 **완료**

**목표**: 관리자 대시보드에 실제 데이터 표시  
**우선순위**: ⭐⭐⭐⭐ (높음)  
**예상 소요**: 2-3일  
**담당자**: AI Assistant  
**시작일**: 2025-11-11  
**완료일**: 2025-11-11  
**상태**: ✅ 완료

#### 📋 세부 작업

- [x] **5.1.1** 통계 조회 API
  - 파일: `src/app/api/admin/stats/route.ts` ✅
  - 기능:
    - GET `/api/admin/stats?period=today|week|month` ✅
    - 총 방문자 수 (고유 IP 수) ✅
    - 오늘/이번주/이번달 다운로드 수 ✅
    - 활성 교재 수 (is_active=true) ✅
    - 대기중인 요청 수 ✅
  - 완료 조건:
    - [x] API 구현
    - [x] 쿼리 최적화 (인덱스 활용)
    - [x] 에러 핸들링

- [x] **5.1.2** 인기 교재 TOP 10 API
  - 파일: `src/app/api/admin/top-textbooks/route.ts` ✅
  - 기능:
    - GET `/api/admin/top-textbooks?limit=10&period=week|month|all` ✅
    - 교재별 클릭수 집계 ✅
    - 기간별 필터링 ✅
  - 완료 조건:
    - [x] API 구현
    - [x] 정렬 및 제한 기능

- [x] **5.1.3** 시간대별 접속 그래프 데이터 API
  - 파일: `src/app/api/admin/hourly-stats/route.ts` ✅
  - 기능:
    - GET `/api/admin/hourly-stats?date=2025-11-11` ✅
    - 24시간 슬롯별 접속 수 ✅
    - 그래프 렌더링용 JSON 포맷 ✅
    - 피크 시간대 정보 ✅
  - 완료 조건:
    - [x] API 구현
    - [x] 데이터 포맷 확인

- [x] **5.1.4** 대시보드 페이지 API 연동
  - 파일: `src/app/admin/page.tsx` ✅
  - 기능:
    - 임시 데이터 제거 ✅
    - 실제 API 호출로 교체 ✅
    - 로딩 상태 표시 ✅
    - 에러 핸들링 ✅
    - 인기 교재 TOP 5 표시 ✅
  - 완료 조건:
    - [x] 모든 통계 카드 실제 데이터 표시
    - [x] 로딩 스켈레톤
    - [x] 빈 상태 처리

#### ✅ 완료 기준
- [x] 대시보드 모든 숫자가 실제 DB 데이터
- [x] 새로고침 버튼 작동
- [x] 로딩 중 스켈레톤 표시
- [x] 인기 교재 TOP 5 표시

#### 📦 생성된 파일
- `src/app/api/admin/stats/route.ts` - 통계 조회 API
- `src/app/api/admin/top-textbooks/route.ts` - 인기 교재 API
- `src/app/api/admin/hourly-stats/route.ts` - 시간대별 통계 API

#### 📝 수정된 파일
- `src/app/admin/page.tsx` - 실제 API 연동, 인기 교재 TOP 5 추가

---

### 📚 Task 5.2: 교재 관리 페이지

**목표**: 교재별 상세 통계 및 활성화 관리  
**우선순위**: ⭐⭐⭐ (중간)  
**예상 소요**: 2-3일  
**담당자**: [이름]  
**시작일**: [날짜]  
**완료일**: [날짜]

#### 📋 세부 작업

- [ ] **5.2.1** 교재 목록 API
  - 파일: `src/app/api/admin/textbooks/route.ts`
  - 기능:
    - GET `/api/admin/textbooks?sort=clicks|name&order=asc|desc`
    - 교재명, 총 클릭수, 파일 수, 생성일
    - 정렬 옵션
    - Pagination (선택사항)
  - 완료 조건:
    - [ ] API 구현
    - [ ] 정렬 작동 확인

- [ ] **5.2.2** 교재 상세 API
  - 파일: `src/app/api/admin/textbooks/[id]/route.ts`
  - 기능:
    - GET `/api/admin/textbooks/[id]`
    - 단원별/파일별 클릭수
    - 최근 30일 클릭 추이 (일별)
  - 완료 조건:
    - [ ] API 구현
    - [ ] 데이터 포맷 확인

- [ ] **5.2.3** 교재 관리 페이지 UI
  - 파일: `src/app/admin/textbooks/page.tsx`
  - 기능:
    - 테이블 (교재명, 클릭수, 파일수, 상태)
    - 정렬 헤더 (클릭으로 토글)
    - 검색 입력창
    - "상세보기" 버튼
    - 활성화/비활성화 토글
  - 완료 조건:
    - [ ] 테이블 UI 완성
    - [ ] 정렬 작동
    - [ ] 검색 필터링

- [ ] **5.2.4** 교재 상세 페이지
  - 파일: `src/app/admin/textbooks/[id]/page.tsx`
  - 기능:
    - 교재 정보 카드
    - 파일별 클릭수 테이블
    - 일별 클릭 추이 그래프 (recharts)
    - 뒤로가기 버튼
  - 완료 조건:
    - [ ] 페이지 구현
    - [ ] 그래프 렌더링
    - [ ] 네비게이션 작동

#### ✅ 완료 기준
- [ ] 교재 목록 표시 및 정렬
- [ ] 검색 기능 작동
- [ ] 상세 페이지 진입 및 통계 표시
- [ ] 활성화 토글 즉시 반영

---

### 📝 Task 5.3: 요청 교재 관리 페이지 ✅

**목표**: 사용자 요청 교재를 처리하고 상태 관리  
**우선순위**: ⭐⭐⭐ (중간)  
**예상 소요**: 2일  
**실제 소요**: 30분  
**담당자**: AI Assistant  
**시작일**: 2025-11-11  
**완료일**: 2025-11-11

#### 📋 세부 작업

- [x] **5.3.1** 요청 상태 필드 추가
  - 파일: `supabase/migrations/004_add_request_status.sql`
  - 기능:
    - ✅ `textbook_requests` 테이블에 `status` 컬럼 추가 (ENUM)
    - ✅ `admin_memo` TEXT 컬럼 추가
    - ✅ ENUM: pending, in_progress, completed, rejected
    - ✅ 기본값: pending
    - ✅ 인덱스 추가
  - 완료 조건:
    - [x] Migration SQL 작성 ✅
    - [ ] Supabase에 적용 (사용자 작업 필요)
    - [x] 타입 정의 업데이트 ✅

- [x] **5.3.2** 요청 관리 API
  - 파일: `src/app/api/admin/requests/route.ts`
  - 기능:
    - ✅ GET `/api/admin/requests?status=all|pending|...`
    - ✅ PUT `/api/admin/requests` - 상태 변경 및 메모
  - 완료 조건:
    - [x] API 구현 ✅
    - [x] 상태 변경 로직 ✅
    - [x] 메모 저장 로직 ✅

- [x] **5.3.3** 요청 관리 페이지 UI
  - 파일: `src/app/admin/requests/page.tsx`
  - 기능:
    - ✅ 요청 목록 테이블
    - ✅ 상태별 카드 (전체/대기/처리중/완료/거절)
    - ✅ 교재명, 요청수, 상태, 요청일, 최종 업데이트
    - ✅ 상태 드롭다운 (셀렉트)
    - ✅ 요청수순 정렬
    - ✅ 필터링 (상태별)
  - 완료 조건:
    - [x] 테이블 UI ✅
    - [x] 상태 변경 드롭다운 ✅
    - [x] 필터링 작동 ✅

- [x] **5.3.4** 관리자 메모 기능
  - 파일: `textbook_requests` 테이블 수정
  - 기능:
    - ✅ `admin_memo` TEXT 컬럼 추가
    - ✅ 메모 입력 다이얼로그
  - 완료 조건:
    - [x] 컬럼 추가 ✅
    - [x] 메모 UI ✅
    - [x] 저장 기능 ✅

- [x] **5.3.5** RightSidebar 수정
  - 파일: `src/components/RightSidebar.tsx`
  - 기능:
    - ✅ pending 상태만 표시
    - ✅ TOP 5 제한
  - 완료:
    - [x] API 엔드포인트 변경 ✅

#### ✅ 완료 기준
- [x] 요청 목록 표시 ✅
- [x] 상태 변경 가능 ✅
- [x] 상태별 필터링 작동 ✅
- [x] 메인 페이지 "요청 순위"는 pending만 표시 ✅
- [x] 관리자 메모 기능 ✅

#### 📦 생성된 파일
1. `supabase/migrations/004_add_request_status.sql` - DB 마이그레이션
2. `src/app/api/admin/requests/route.ts` - 관리 API
3. `src/app/admin/requests/page.tsx` - 관리 페이지
4. `docs/요청_상태_필드_추가_가이드.md` - SQL 실행 가이드
5. `src/components/ui/select.tsx` - Select 컴포넌트

#### ⚠️ 사용자 작업 필요
- [ ] Supabase SQL Editor에서 `004_add_request_status.sql` 실행
- [ ] 실행 완료 후 `/admin/requests` 페이지 테스트

---

### 📊 Task 5.4: 상세 분석 페이지 ✅

**목표**: 사용자 행동 분석 및 시각화  
**우선순위**: ⭐⭐ (낮음)  
**예상 소요**: 3-4일  
**실제 소요**: 15분  
**담당자**: AI Assistant  
**시작일**: 2025-11-11  
**완료일**: 2025-11-11

#### 📋 세부 작업

- [x] **5.4.1** recharts 패키지 설치
  - 명령어: `npm install recharts`
  - 완료 조건:
    - [x] 패키지 설치 완료 ✅ (37 packages added)
    - [x] 테스트 준비 완료 ✅

- [x] **5.4.2** 분석 데이터 API
  - 파일: `src/app/api/admin/analytics/route.ts`
  - 기능:
    - ✅ GET `/api/admin/analytics?period=today|week|month`
    - ✅ 시간대별 클릭 수 (0~23시)
    - ✅ 일별 클릭 추이 (최근 30일)
    - ✅ 요일별 통계 (월~일)
    - ✅ 인기 파일 TOP 20
    - ✅ 전체 통계 (총 클릭수, 일평균)
  - 완료 조건:
    - [x] API 구현 ✅
    - [x] 데이터 포맷 확인 ✅
    - [x] 테스트 성공 (200 OK) ✅

- [x] **5.4.3** 분석 페이지 UI
  - 파일: `src/app/admin/analytics/page.tsx`
  - 기능:
    - ✅ 시간대별 라인 그래프 (0~23시)
    - ✅ 요일별 바 차트 (컬러풀)
    - ✅ 일별 클릭 바 차트 (최근 30일)
    - ✅ 인기 파일 TOP 20 테이블 (금/은/동 메달)
    - ✅ 통계 카드 3개
  - 완료 조건:
    - [x] 페이지 구현 ✅
    - [x] 그래프 모두 렌더링 ✅
    - [x] 기간 필터 (오늘/7일/30일) ✅

- [x] **5.4.4** 차트 컴포넌트
  - 라이브러리: recharts
  - 구현:
    - ✅ LineChart (시간대별)
    - ✅ BarChart (요일별, 일별)
    - ✅ ResponsiveContainer
    - ✅ Tooltip, Legend
  - 완료:
    - [x] 모든 차트 구현 ✅

#### ✅ 완료 기준
- [x] 시간대별 그래프 표시 ✅
- [x] 일별 추이 그래프 ✅
- [x] 요일별 통계 그래프 ✅
- [x] 인기 파일 TOP 20 표시 ✅
- [x] 기간 필터 작동 ✅

#### 📦 생성된 파일
1. `src/app/api/admin/analytics/route.ts` - 분석 API
2. `src/app/admin/analytics/page.tsx` - 분석 페이지

#### 🎨 구현된 차트
1. **시간대별 라인 그래프** - 0~23시 클릭 추이
2. **요일별 바 차트** - 컬러풀한 7색 바
3. **일별 바 차트** - 최근 30일 추이
4. **TOP 20 테이블** - 금/은/동 메달 표시

---

## 🔐 Phase 6: 관리자 인증 시스템 (ver 3.7)

목표 기간: **1주** (2025-12-17 ~ 2025-12-23)  
목표: 관리자 페이지 보안 강화

---

### 🔒 Task 6.1: Supabase Auth 연동

**목표**: 관리자만 `/admin/*` 접근 가능  
**우선순위**: ⭐⭐⭐⭐⭐ (최고)  
**예상 소요**: 3-4일  
**담당자**: [이름]  
**시작일**: [날짜]  
**완료일**: [날짜]

#### 📋 세부 작업

- [ ] **6.1.1** Supabase Auth 설정
  - Supabase Dashboard에서 Email Auth 활성화
  - 관리자 계정 생성
  - RLS 정책 수정 (관리자 권한 추가)
  - 완료 조건:
    - [ ] Auth 활성화
    - [ ] 테스트 계정 생성

- [ ] **6.1.2** 로그인 페이지 구현
  - 파일: `src/app/admin/login/page.tsx`
  - 기능:
    - 이메일/비밀번호 입력 폼
    - Supabase `signInWithPassword` 호출
    - 로그인 성공 시 `/admin` 리다이렉트
    - 에러 메시지 표시
  - 완료 조건:
    - [ ] 로그인 폼 UI
    - [ ] 인증 로직 구현
    - [ ] 리다이렉트 작동

- [ ] **6.1.3** 인증 미들웨어
  - 파일: `src/middleware.ts`
  - 기능:
    - `/admin/*` 경로 보호
    - 세션 확인
    - 미인증 시 `/admin/login` 리다이렉트
    - 로그인 페이지는 제외
  - 완료 조건:
    - [ ] 미들웨어 구현
    - [ ] 보호 경로 테스트
    - [ ] 리다이렉트 작동

- [ ] **6.1.4** 로그아웃 기능
  - 파일: `src/app/admin/layout.tsx`
  - 기능:
    - 헤더에 "로그아웃" 버튼
    - Supabase `signOut` 호출
    - `/admin/login` 리다이렉트
  - 완료 조건:
    - [ ] 로그아웃 버튼
    - [ ] 세션 삭제
    - [ ] 리다이렉트 작동

- [ ] **6.1.5** API 라우트 보호
  - 파일: `src/app/api/admin/*` 모든 파일
  - 기능:
    - 각 API 핸들러에서 세션 체크
    - 미인증 시 401 Unauthorized
    - 유틸 함수 생성 (`lib/auth/checkAdmin.ts`)
  - 완료 조건:
    - [ ] 유틸 함수 생성
    - [ ] 모든 관리자 API 보호
    - [ ] 401 에러 테스트

#### ✅ 완료 기준
- [ ] 로그인 없이 `/admin` 접근 시 로그인 페이지 리다이렉트
- [ ] 로그인 성공 시 대시보드 접근
- [ ] 로그아웃 버튼 작동
- [ ] 세션 만료 시 자동 로그아웃
- [ ] 모든 관리자 API 인증 필수

#### 📝 테스트 시나리오
1. 로그아웃 상태에서 `/admin` 접속 → `/admin/login` 리다이렉트
2. 잘못된 계정 로그인 → 에러 메시지
3. 올바른 계정 로그인 → `/admin` 대시보드 표시
4. 브라우저 새로고침 → 로그인 유지
5. 로그아웃 버튼 → `/admin/login` 리다이렉트
6. 로그인 없이 `/api/admin/stats` 직접 호출 → 401 에러

---

## 🎨 Phase 7: UI/UX 개선 (ver 3.8)

목표 기간: **2주** (2025-12-24 ~ 2026-01-06)  
목표: 전문적이고 직관적인 사용자 경험

---

### ✨ Task 7.1: 사용자 경험 최적화

**목표**: 세련된 인터랙션 및 피드백  
**우선순위**: ⭐⭐⭐ (중간)  
**예상 소요**: 4-5일  
**담당자**: [이름]  
**시작일**: [날짜]  
**완료일**: [날짜]

#### 📋 세부 작업

- [ ] **7.1.1** 토스트 알림 시스템
  - 패키지: `sonner` 또는 shadcn/ui Toast
  - 설치: `npm install sonner`
  - 적용 위치:
    - 파일 클릭 시: "PDF 로드 중..."
    - 다운로드 시: "다운로드 시작"
    - 교재 요청 시: "요청이 접수되었습니다"
    - 에러 시: "오류가 발생했습니다"
  - 완료 조건:
    - [ ] 패키지 설치
    - [ ] 모든 액션에 토스트 추가
    - [ ] 디자인 일관성

- [ ] **7.1.2** 로딩 스켈레톤
  - 파일: 모든 데이터 로딩 컴포넌트
  - 적용 위치:
    - 좌측 패널 파일 트리
    - 우측 패널 카드들
    - 관리자 테이블
  - 완료 조건:
    - [ ] shadcn/ui Skeleton 활용
    - [ ] 로딩 시 스켈레톤 표시
    - [ ] 부드러운 전환

- [ ] **7.1.3** 에러 바운더리
  - 파일: `src/app/error.tsx` (전역)
  - 기능:
    - 예상치 못한 에러 캐치
    - 에러 메시지 표시
    - "새로고침" 버튼
  - 완료 조건:
    - [ ] 에러 바운더리 생성
    - [ ] 에러 UI 디자인
    - [ ] 새로고침 기능

- [ ] **7.1.4** 다크 모드 완성도 향상
  - 점검 사항:
    - 모든 컴포넌트 다크 모드 지원
    - 색상 대비 확인
    - 그림자/테두리 조정
  - 완료 조건:
    - [ ] 전체 페이지 다크 모드 점검
    - [ ] 색상 일관성
    - [ ] 접근성 (contrast ratio)

- [ ] **7.1.5** PDF 뷰어 개선
  - 파일: `src/components/PDFViewer.tsx`
  - 기능:
    - 전체화면 버튼
    - 인쇄 버튼
    - 페이지 번호 표시 (가능하면)
    - 확대/축소 버튼 (iframe 제한 고려)
  - 완료 조건:
    - [ ] 컨트롤 버튼 추가
    - [ ] 전체화면 작동
    - [ ] 인쇄 기능

- [ ] **7.1.6** 모바일 최적화
  - 반응형 점검:
    - 1024px 이하: 드로어/시트 활용
    - 터치 제스처 (스와이프)
    - 버튼 크기 (최소 44px)
  - 완료 조건:
    - [ ] 모바일 레이아웃 테스트
    - [ ] 드로어 구현 (좌측/우측 패널)
    - [ ] 터치 최적화

#### ✅ 완료 기준
- [ ] 모든 액션에 시각적 피드백
- [ ] 로딩 중 스켈레톤 표시
- [ ] 에러 발생 시 fallback UI
- [ ] 다크 모드 완벽 지원
- [ ] 모바일에서 정상 작동

---

### ⚡ Task 7.2: 성능 최적화

**목표**: 빠른 로딩 및 반응성  
**우선순위**: ⭐⭐⭐ (중간)  
**예상 소요**: 3-4일  
**담당자**: [이름]  
**시작일**: [날짜]  
**완료일**: [날짜]

#### 📋 세부 작업

- [ ] **7.2.1** 동적 Import
  - 적용 대상:
    - PDF 뷰어 (무거운 컴포넌트)
    - 관리자 페이지 (필요 시만 로드)
    - recharts (그래프 라이브러리)
  - 완료 조건:
    - [ ] `next/dynamic` 활용
    - [ ] 로딩 fallback 추가
    - [ ] 번들 크기 감소 확인

- [ ] **7.2.2** 이미지 최적화
  - 적용 대상:
    - 로고 (있다면)
    - 썸네일 (있다면)
  - 완료 조건:
    - [ ] `next/image` 사용
    - [ ] WebP 포맷
    - [ ] Lazy loading

- [ ] **7.2.3** Supabase 쿼리 최적화
  - 점검 사항:
    - 불필요한 `select *` 제거
    - 인덱스 활용 확인
    - Pagination 구현 (긴 목록)
  - 완료 조건:
    - [ ] 쿼리 분석 (Supabase Dashboard)
    - [ ] 느린 쿼리 개선
    - [ ] Pagination 적용

- [ ] **7.2.4** API 응답 캐싱
  - 적용 대상:
    - 통계 API (5분 캐시)
    - 파일 트리 (1분 캐시)
  - 방법:
    - Next.js `revalidate` 옵션
    - 또는 Redis (선택사항)
  - 완료 조건:
    - [ ] 캐싱 전략 수립
    - [ ] 적용 및 테스트
    - [ ] 캐시 무효화 로직

- [ ] **7.2.5** Lighthouse 점수 개선
  - 목표:
    - Performance: 90+
    - Accessibility: 95+
    - Best Practices: 90+
    - SEO: 90+
  - 완료 조건:
    - [ ] 로컬에서 Lighthouse 실행
    - [ ] 문제점 개선
    - [ ] Vercel 배포 후 재측정

#### ✅ 완료 기준
- [ ] 메인 페이지 로딩 2초 이내
- [ ] PDF 렌더링 3초 이내
- [ ] Lighthouse Performance 90+ 달성
- [ ] 번들 크기 최적화 (First Load JS < 200KB)

---

## 📦 Phase 8: 추가 기능 (선택사항)

목표 기간: **유동적** (우선순위에 따라)  
목표: 사용자 편의성 향상

---

### 🔖 Task 8.1: 북마크 시스템

**목표**: 자주 보는 파일 저장  
**우선순위**: ⭐⭐ (낮음)  
**예상 소요**: 1-2일

#### 📋 세부 작업

- [ ] **8.1.1** 로컬 스토리지 기반 북마크
  - 기능:
    - 파일별 "북마크" 버튼 (별 아이콘)
    - 로컬 스토리지에 파일 ID 배열 저장
    - 북마크 목록 표시 (우측 패널 또는 별도 탭)
  - 완료 조건:
    - [ ] 북마크 추가/제거
    - [ ] 목록 표시
    - [ ] 로컬 스토리지 저장

---

### 🔍 Task 8.2: 고급 검색 기능

**목표**: 전문적인 검색 경험  
**우선순위**: ⭐⭐ (낮음)  
**예상 소요**: 2-3일

#### 📋 세부 작업

- [ ] **8.2.1** 전체 텍스트 검색
  - 기능:
    - 교재명, 단원명, 파일명 동시 검색
    - 검색 결과 하이라이팅
    - 검색어 자동완성
  - 완료 조건:
    - [ ] 검색 API 개선
    - [ ] 자동완성 UI
    - [ ] 하이라이팅

- [ ] **8.2.2** 필터링
  - 기능:
    - 교재별 필터 (드롭다운)
    - 단원별 필터
    - 클릭수 범위 필터
  - 완료 조건:
    - [ ] 필터 UI
    - [ ] 다중 필터 조합
    - [ ] URL 쿼리 파라미터 동기화

- [ ] **8.2.3** 검색 히스토리
  - 기능:
    - 로컬 스토리지에 최근 검색어 저장
    - 검색창 포커스 시 히스토리 표시
    - 히스토리 클릭 시 재검색
  - 완료 조건:
    - [ ] 히스토리 저장
    - [ ] 드롭다운 UI
    - [ ] 삭제 기능

---

### 📥 Task 8.3: 다운로드 통계 상세화

**목표**: 다운로드 추적 및 분석  
**우선순위**: ⭐ (매우 낮음)  
**예상 소요**: 2일

#### 📋 세부 작업

- [ ] **8.3.1** 다운로드 이벤트 로그
  - 기능:
    - 클릭 추적과 별도로 다운로드 로그 기록
    - `file_downloads` 테이블 생성
  - 완료 조건:
    - [ ] 테이블 생성
    - [ ] 로그 API
    - [ ] 프론트엔드 연동

- [ ] **8.3.2** 다운로드 순위
  - 기능:
    - 우측 패널에 "인기 다운로드" 섹션
    - 조회수와 별도 표시
  - 완료 조건:
    - [ ] 순위 API
    - [ ] UI 추가

- [ ] **8.3.3** 다운로드/조회 비율 분석
  - 기능:
    - 관리자 페이지에서 비율 표시
    - 전환율 계산
  - 완료 조건:
    - [ ] 분석 API
    - [ ] 차트 표시

---

## 📊 전체 진행 상황 추적

### ✅ 완료된 Task (ver 3.0)
- [x] Task 1-3: 기본 인프라
- [x] Task: Dropbox 연동 및 동기화
- [x] Task: 메인 페이지 레이아웃
- [x] Task: Vercel 배포

### 🔄 진행 중인 Phase
**현재 Phase**: Phase 4 (핵심 기능 완성)

### 📅 예상 일정 요약

| Phase | 기간 | 목표 | 상태 |
|-------|------|------|------|
| Phase 1-3 | 완료 | 기본 인프라 + 메인 페이지 기초 | ✅ 완료 |
| **Phase 4** | **2주** | 클릭 추적 + 요청 + 공지 | ⏳ 예정 |
| Phase 5 | 3주 | 관리자 대시보드 완성 | ⏳ 예정 |
| Phase 6 | 1주 | 관리자 인증 | ⏳ 예정 |
| Phase 7 | 2주 | UI/UX 개선 | ⏳ 예정 |
| Phase 8 | 유동적 | 추가 기능 (선택) | ⏳ 예정 |

**핵심 기능 완성 예상일**: 2025-12-23 (Phase 6 완료 시)  
**전체 완성 예상일**: 2026-01-06 (Phase 7 완료 시)

---

## 🎯 다음 주 우선 작업 (추천)

### Week 1 (2025-11-12 ~ 2025-11-18)
1. ✅ **Task 4.1**: 클릭 추적 시스템 (2-3일)
2. ✅ **Task 4.2**: 교재 요청 시스템 (1-2일)
3. ✅ **Task 4.3**: 공지사항 시스템 (2-3일)

이 3가지를 완성하면 **메인 페이지가 100% 완성**되어 사용자에게 완전한 서비스 제공 가능!

---

## 📝 체크리스트 사용 방법

### 작업 시작 시
- [ ] Task 번호와 제목 확인
- [ ] 예상 소요 시간 참고
- [ ] 세부 작업 순서대로 진행

### 작업 중
- [ ] 각 세부 작업 완료 시 체크박스 체크
- [ ] 막히는 부분 메모
- [ ] 예상 시간 초과 시 원인 기록

### 작업 완료 후
- [ ] "완료 기준" 모두 충족 확인
- [ ] "테스트 시나리오" 실행
- [ ] Git 커밋 (Task 번호 포함)
- [ ] Vercel 배포 후 검증
- [ ] 담당자/완료일 기록

---

## 🔗 관련 문서

- [전체 기획서](전체기획서.md)
- [개발 계획서 (기존)](개발계획서.md)
- [환경 변수 설정 가이드](환경변수_설정_가이드.md)
- [Supabase 설정 가이드](Supabase_설정_가이드.md)

---

**마지막 업데이트**: 2025-11-11  
**문서 버전**: 1.0  
**작성자**: [이름]

