# 공지사항(notices) 테이블 생성 가이드

## 📌 개요
사용자에게 표시될 공지사항을 관리하기 위한 `notices` 테이블을 Supabase에 생성합니다.

---

## 🔧 테이블 생성 방법

### 1. Supabase Dashboard 접속
1. [Supabase Dashboard](https://supabase.com/dashboard) 접속
2. 프로젝트 선택

### 2. SQL Editor 열기
1. 좌측 메뉴에서 **SQL Editor** 클릭
2. **New Query** 버튼 클릭

### 3. SQL 실행
1. `supabase/migrations/003_create_notices.sql` 파일 내용 전체 복사
2. SQL Editor에 붙여넣기
3. **RUN** 버튼 클릭 (또는 `Ctrl + Enter`)

### 4. 결과 확인
- 성공 메시지: `Success. No rows returned`
- **Table Editor**에서 `notices` 테이블 확인

---

## 📊 테이블 구조

| 컬럼명 | 타입 | 설명 | 기본값 |
|--------|------|------|--------|
| `id` | UUID | 고유 ID | uuid_generate_v4() |
| `title` | VARCHAR(255) | 공지사항 제목 | - |
| `content` | TEXT | 공지사항 내용 | - |
| `is_active` | BOOLEAN | 활성 상태 | true |
| `created_at` | TIMESTAMP | 생성 시간 | NOW() |
| `updated_at` | TIMESTAMP | 수정 시간 | NOW() |

---

## 🔒 RLS(Row Level Security) 정책

### 1. Public read access for active notices
- **대상**: 모든 사용자
- **권한**: `SELECT`
- **조건**: `is_active = true` (활성 공지사항만)

### 2. Service role full access for notices
- **대상**: 서비스 역할 (관리자 API)
- **권한**: `ALL` (SELECT, INSERT, UPDATE, DELETE)
- **조건**: 제한 없음

---

## 📝 샘플 데이터
마이그레이션 실행 시 2개의 샘플 공지사항이 자동으로 생성됩니다:
1. "🎉 영어 자료실 오픈!"
2. "📚 신규 교재 업데이트"

---

## ✅ 기능 확인

### 1. 메인 페이지 확인
- 우측 패널에 "공지사항" 섹션 확인
- 샘플 공지사항 2개 표시 확인

### 2. 관리자 페이지 확인
- `/admin/notices` 접속
- 공지사항 목록 확인
- **새 공지 작성** 버튼 클릭
- 공지사항 생성/수정/삭제 테스트

### 3. 실시간 업데이트 확인
1. 브라우저 2개 창 열기
   - 창 1: 메인 페이지 (`/`)
   - 창 2: 관리자 페이지 (`/admin/notices`)
2. 창 2에서 새 공지 작성
3. 창 1에서 자동으로 공지사항 업데이트 확인 ✨

---

## 🚨 문제 해결

### 오류: "permission denied for table notices"
**원인**: RLS 정책이 올바르게 설정되지 않음

**해결**:
1. Supabase Dashboard → **Authentication** → **Policies**
2. `notices` 테이블 정책 확인
3. 마이그레이션 SQL 다시 실행

### 오류: "column "updated_at" does not exist"
**원인**: 테이블 생성 순서 문제

**해결**:
1. `DROP TABLE IF EXISTS notices CASCADE;` 실행
2. 마이그레이션 SQL 전체 다시 실행

---

## 📚 관련 파일
- `supabase/migrations/003_create_notices.sql` - 테이블 생성 SQL
- `src/app/api/notices/route.ts` - 공지사항 CRUD API
- `src/app/admin/notices/page.tsx` - 관리자 공지사항 관리 페이지
- `src/components/admin/NoticeForm.tsx` - 공지사항 작성/수정 폼
- `src/components/RightSidebar.tsx` - 메인 페이지 공지사항 표시

